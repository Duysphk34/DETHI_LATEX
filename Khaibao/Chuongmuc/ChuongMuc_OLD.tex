%\usepackage[explicit]{titlesec}
%%\titleformat{\chapter}[display]
%%  {\normalfont\huge\bfseries}
%%  {}
%%  {3pt}
%%  {%
%	%    \begin{tcolorbox}[
%		%      enhanced,
%		%      colback=dnxanh!75!black,
%		%      boxrule=0.25cm,
%		%      colframe=dnvang!50,
%		%      arc=0pt,
%		%      halign=center,
%		%      outer arc=0pt,
%		%      leftrule=0pt,
%		%      rightrule=0pt,
%		%      fontupper=\color{white}\sffamily\bfseries\huge,
%		%      enlarge left by=-1in-\hoffset-\oddsidemargin, 
%		%      enlarge right by=-\paperwidth+1in+\hoffset+\oddsidemargin+\textwidth,
%		%      width=\paperwidth, 
%		%      left=1in+\hoffset+\oddsidemargin, 
%		%      right=\paperwidth-1in-\hoffset-\oddsidemargin-\textwidth,
%		%      top=0.6cm, 
%		%      bottom=0.2cm,
%		%      overlay={
%			%      \node[
%			%                inner sep=7pt,
%			%                anchor=west,
%			%                align=center,
%			%                font=\color{white}\sffamily\bfseries\LARGE,
%			%              ] 
%			%              (chapname)
%			%              at ([shift={(2cm,-10pt)}]frame.north west)
%			%              {\chaptername\ \thechapter};
%			%            \fill[rounded corners=3pt,dnvang!65!black] ([xshift=-2pt]chapname.north west)
%			%            	rectangle ([xshift=2pt]chapname.south east);
%			%            \fill[rounded corners=3pt,dnvang!75] ([yshift=0.25pt]chapname.north west)
%			%                        	rectangle ([yshift=-0.25pt]chapname.south east); 
%			%       \node[
%			%                 inner sep=7pt,
%			%                 anchor=west,
%			%                 align=center,
%			%                 font=\color{white}\sffamily\bfseries\LARGE,
%			%               ] 
%			%               at ([shift={(2cm,-10pt)}]frame.north west)
%			%               {\chaptername\ \thechapter};
%			%      }
%		%    ]
%		%    #1
%		%    \end{tcolorbox}%
%	%    \thispagestyle{fancy}
%	%    \fancyfoot[LO]{\color{\mauchinh}{\small\faAngleDoubleRight }{\Large\fmmfamily LaTeX Theme and Related Topics}}
%	%    \fancyfoot[RE]{\color{\mauchinh}{\small\faAngleDoubleRight }{\Large\fmmfamily LaTeX Theme and Related Topics}}
%	%    \fancyfoot[RO]{\color{\mauchinh}{\Large\fmmfamily Trang } \textit{\thepage}} 
%	%    \fancyfoot[LE]{\color{\mauchinh}{\Large\fmmfamily Trang } \textit{\thepage}}
%	%  }
%% 
%%\titlespacing*{\chapter}
%%  {0pt}{0pt}{5pt}
%%%%%%%%%%%%%%%%%%%==============================%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%=============ĐỊNH DẠNG CHAPTER=====================%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%======================Cấu trúc chung===============================%%%%%%%%%%%%%%
%%%%\titlespacing*{\chapter}{0pt}{2cm}{3.5cm}%left,top,bottom
%%%%%\titleformat{command}[shape]{format}{label}{sep}{before-code}[after-code]

\usepackage[explicit]{titlesec}
\setcounter{secnumdepth}{4}
\renewcommand{\chaptertitlename}{CHƯƠNG}
\DeclareFixedFont{\chapternumberfont}{T5}{phv}{bx}{sc}{1.35in}
\DeclareFixedFont{\bigsf}{T5}{ugq}{b}{n}{30pt}
\titlespacing*{\chapter}{0pt}{2cm}{3cm}%left,top,bottom
\titleformat{\chapter}[display]
{\color{white}\fontsize{16pt}{1pt}\fontfamily{qag}\selectfont\bfseries}
{\begin{tikzpicture}[remember picture, overlay]
		\path 
		([shift={(.85,-2.85)}]current page.north west) coordinate (A1)
		([shift={(-.85,-7.15)}]current page.north east) coordinate (B1)
		;
		\fill [dnvang,rounded corners=13pt]
		(A1) rectangle (B1)
		;
		\path 
		([shift={(1.0,-3.0)}]current page.north west) coordinate (A)
		([shift={(-1.0,-7)}]current page.north east) coordinate (B)
		([shift={(16.0,-1.5)}]current page.north west) coordinate (C)
		([shift={(18.6,-3.5)}]current page.north west) coordinate (D)
		($ (A)!0.5!(B) $)  coordinate (tieudechuong)
		($ (C)!0.5!(D) $)  coordinate (CD)
		;
		\draw [white!80,rounded corners=10pt,ultra thick]
		(A) rectangle (B)
		;
		\draw[dnvang!60!white,rounded corners=10pt,fill=dnvang!80,ultra thick]
		(C) rectangle (D);
		\node[font=\fontsize{50pt}{6pt}\selectfont\sffamily\bfseries,white] (chapternum) at (CD) {\thechapter} 
		;
		\node[font=\fontsize{25pt}{6pt}\selectfont\sffamily\bfseries,dnvang,anchor=east] at ([shift={(-1,.25)}]chapternum.west) {\chaptertitlename}
		;
		\node[font=\Huge\color{white}\bigsf] at (tieudechuong) {\MakeUppercase{#1}}
		;	
\end{tikzpicture}}
{1ex minus .1ex}
{}
[]












%\titlespacing*{\section}{0pt}{3pt}{1pt}
%\titleformat{\section}[display]
%  {}
%  {%
% \begin{tikzpicture}[declare function={rt=0.65;d=sqrt(2)*rt;}]
%  \path (90:rt) coordinate (A)
%  (180:rt) coordinate (B)
%  (270:rt) coordinate (C)
%  (0:rt) coordinate (D)
%  ([shift={(0.15,0)}]0:rt) coordinate (E)
%  ($ (E)+(135:rt) $) coordinate (F)
%  ($ (E)+(-135:rt) $) coordinate (G)
%  ($ (A)!0.5!(F) $) coordinate (AF)
%  ($ (D)!0.5!(E) $) coordinate (DE)
%  ($ (C)!0.5!(G) $) coordinate (CG)
%  ;
%  \path[outer color=dnxanhdam!65!black,inner color=dnxanhdam!80,rounded corners=2pt] (A)--(B)--(C)--(D)--cycle;
%  \draw[line width=0.65pt,dnxanhdam,line cap=round,rounded corners=1.5pt]
%  (AF)--(DE)--(CG);
%  \draw[transform canvas={xscale=-1},line width=0.65pt,dnxanhdam,line cap=round,rounded corners=1.5pt] (AF)--(DE)--(CG);
%  \path (-0.7pt,-0.3pt) node[inner sep=0pt,font=\Large\itshape\bfseries\color{gray}]{\arabic{section}};
%  \path (-1pt,0) node[inner sep=0pt,font=\Large\itshape\bfseries\color{white}]{\arabic{section}};  
% \path ([shift={(0.11,-0.01)}]E) node[align=left,anchor=west,font=\Large\sffamily\bfseries\color{gray},text width=0.9\linewidth](SEC){#1};
% \path (intersection of SEC.north west--SEC.north east and E--F) coordinate (Ft)
% (intersection of SEC.south west--SEC.south east and E--G) coordinate (Gt);
%  \path[left color=dnxanhdam!90!black,right color=dnxanhdam!50,rounded corners=2pt] (Gt)--(E)--(Ft)--(SEC.north east)--(SEC.south east)--cycle;
%  \path ([shift={(0.11,-0.01)}]E) node[align=left,anchor=west,font=\Large\sffamily\bfseries\color{gray},text width=0.9\linewidth]{#1};
%  \path ([shift={(0.1,0)}]E) node[align=left,anchor=west,font=\Large\sffamily\bfseries\color{white},text width=0.9\linewidth]{#1};
%  \end{tikzpicture}%
%  }%
%  {0pt}
%  {}
  
 %%%============================Định dạng section==================================%%%%%%%%%%%%
 \renewcommand{\thesection}{\arabic{section}}
 \titlespacing*{\section}{0pt}{3pt}{3cm}
 \titleformat{\section}[display]
 {}
 {%
 	\begin{tikzpicture}[remember picture, overlay,declare function={d=1.0cm;r=3.0cm;}]
 		\path 
 		(0,0) coordinate (A)
 		(0,d) coordinate (B)
 		(A)--(B)--([turn]-90:r) coordinate (C)
 		(r+0.8cm,0) coordinate (D)
 		(\linewidth-.5cm,-3pt) coordinate (E)
 		(.25,0) coordinate (A1)
 		(.25,-3) coordinate (B1)
 		(\linewidth-0.75cm,0) coordinate (C1)
 		(\linewidth-0.75cm,-3) coordinate (D1)
 		($ (A)!0.5!(D) $) coordinate (ChuBai)
 		($ (A1)!0.5!(B1) $) coordinate (A1B1)
 		($ (C1)!0.5!(D1) $) coordinate (C1D1)
 		($ (A1B1)!0.5!(C1D1) $) coordinate (Tenbai)
 		([xshift=1pt]C) coordinate (Ct)
 		([xshift=1pt]D) coordinate (Dt)
 		;
 		\fill[dnvang] (A)--(B)--(C)--(D)--cycle
 		(A) rectangle (E)
 		;
 			\path (Ct)--++(2pt,0) coordinate (Ctt)
 		(Dt)--++(2pt,0) coordinate (Dtt)
 		;
 		\fill[dnvang] (Ct)--(Dt)--(Dtt)--(Ctt)--cycle
 		;
 		\foreach \i/\j in{3/85,6/75,9/65,12/50,15/30}{
 			\begin{scope}[transform canvas={xshift=\i pt}]
 				\fill[dnvang!\j] (Ct)--(Dt)--(Dtt)--(Ctt)--cycle
 				;
 		\end{scope}}
 		\fill[dnvang!75!black] ([yshift=-3pt]A)--([yshift=-3pt]A1)--([turn]-90:6pt)--cycle;
 		\fill[dnvang!75!black] (E)--([yshift=-3pt]C1)--([turn]90:6pt)--cycle;
 		\draw[dnvang,rounded corners=5pt,ultra thick] (A1)--(B1)--(D1)--(C1)
 		;
 		\path ([xshift= -.25cm,yshift=.5cm]ChuBai) node[inner sep=2pt,font=\fontsize{18pt}{6pt}\sffamily\selectfont\bfseries\color{gray}]{\faDiamond\ BÀI \arabic{section}};
 		\path ([xshift= -.25cm,yshift=.5cm]ChuBai) node[inner sep=0pt,font=\fontsize{18pt}{6pt}\sffamily\selectfont\bfseries\color{white}]{\faDiamond\ BÀI \arabic{section}};  
 		\path ([shift={(0.11,-0.01)}]Tenbai) node[align=center,font=\LARGE\sffamily\bfseries\color{gray},text width=0.9\linewidth]{\MakeUppercase{#1}};
 		\path ([shift={(0.1,0)}]Tenbai) node[align=center,font=\LARGE\sffamily\bfseries\color{dnvang!75!black},text width=0.9\linewidth]{\MakeUppercase{#1}};
 \end{tikzpicture}}%
 {0pt}
 {} 
  
%%%===========================subsection===============%%%
\titlespacing*{\subsection}{3pt}{0pt}{-1pt}
\titleformat{\subsection}[display]
  {}
  {%
 \begin{tikzpicture}
 \path (0,0) node[align=left,anchor=west,font=\Large\sffamily\bfseries\color{white},text width=0.95\linewidth](SEC){#1};
 \path (SEC.north west) coordinate (A)
	 (SEC.south west) coordinate (B)
	 ($ (A)+(-1pt,-3pt) $)  coordinate (At)
	 ($ (B)+(-1pt,3pt) $)  coordinate (Bt)
	 ($(At)!1!90:(Bt)$) coordinate (Dt)
	 ($(Bt)!1!-90:(At)$) coordinate (Ct)
	 ($ (Ct)!0.5!(Dt) $) coordinate (E)
	  ($ (Ct)!0.5!(At) $) coordinate (AC)
	 ;
  \draw[line width=1pt,dnvang!55!black,rounded corners=3pt] (A) rectangle ($(B)+(0.975\linewidth,0) $);
  \fill[rounded corners=2pt,fill=dnvang!80!black] ($ (At)+(-3pt,0) $) rectangle (Ct); 
  \fill[rounded corners=2pt,fill=dnvang] (At) rectangle (Ct);
   \path ([shift={(-45:1pt)}]AC) node[inner sep=0pt,font=\large\bfseries\color{gray}]{\Alph{subsection}};
   \path (AC) node[inner sep=0pt,font=\large\bfseries\color{white}]{\Alph{subsection}};  
   \path ([shift={(-45:0.65pt)}]E) node[align=left,anchor=west,font=\large\sffamily\bfseries\color{gray},text width=0.95\linewidth]{#1};
   \path (E) node[align=left,anchor=west,font=\large\sffamily\bfseries\color{dnvang!75!black},text width=0.95\linewidth]{#1};
  \end{tikzpicture}%
  }%
  {0pt}
  {}
  
   \renewcommand{\thesubsubsection}{\arabic{subsubsection}}
   %%%===========================subsection===============%%%
   \titlespacing*{\subsubsection}{3pt}{0pt}{-1pt}
   \titleformat{\subsubsection}[display]
   {}
   {
   	\begin{tikzpicture}[remember picture]
   		\path (0,0) 
   		node [dnvang,minimum height= .8cm,font=\bfseries \fontfamily{qag}\selectfont](Sub)%
   		{\arabic{subsubsection}.};
   		\path
   		(Sub.north west)coordinate (B)
   		(Sub.south east)coordinate (C)
   		(Sub.west)coordinate (D)
   		(Sub.east)coordinate (E)
   		($ (D)+(3pt,0) $) coordinate (D1)
   		($ (E)+(3pt,0) $) coordinate (E1)
   		;
   		\fill[dnvang!40] (B)--(Sub.north east)--(E1)--(C)--(Sub.south west)--cycle 
   		;
   		\path ($ (Sub.east)+(1pt,0) $) 
   		node [dnvang,minimum height= .8cm,inner sep=3pt,anchor=west,font=\bfseries \fontfamily{qag}\selectfont](Muc)%
   		%{\arabic{subsection}.\;\MakeUppercase{#1}};
   		{#1};
   		\path
   		(Muc.north west)coordinate (Bt)
   		(Muc.south east)coordinate (Ct)
   		(Muc.west)coordinate (Dt)
   		(Muc.east)coordinate (Et)
   		($ (Dt)+(3pt,0) $) coordinate (D1t)
   		($ (Et)+(3pt,0) $) coordinate (E1t)
   		;
   		\fill[dnvang!20] (D1t)--(Bt)--(Muc.north east)--(E1t)--(Ct)--(Muc.south west)--cycle 
   		;
   		\path (0,0) 
   		node [dnvang!50!black,font=\bfseries\fontfamily{qag}\selectfont]%
   		%{\arabic{subsection}.\;\MakeUppercase{#1}};
   		{\arabic{subsubsection}.};
   		\path ($ (Sub.east)+(1pt,0) $) 
   		node [dnvang!50!black,anchor= west,font=\bfseries \fontfamily{qag}\selectfont]%
   		%{\arabic{subsection}.\;\MakeUppercase{#1}};
   		{#1};
   	\end{tikzpicture}
   }{3pt}{}
   
   
%   \titlespacing*{\subsubsection}{-3pt}{0pt}{3pt}
%   \titleformat{\subsubsection}
%     {}
%     {%
%       \danhsoovuong{\arabic{subsubsection}}~\textcolor{dnvang!75!black}{\textbf{\textsf{#1}}}
%     }%
%     {3pt}
%     {}
     %%%==========================================================%%%
    
    \titlespacing*{\paragraph}{0pt}{0pt}{3pt}
     \titleformat{\paragraph}
       {}
       {%
          \textcolor{dnvang!50!black}{\faGgCircle \  \bfseries\textsf{#1}}
       }%
       {3pt}
       {}
       %%%==========================================================%%%
     
     
  %%%=====================Muc luc============================%%%
  \usepackage{titletoc}
  \patchcmd{\tableofcontents}{\contentsname}{\sffamily\contentsname}{}{}
  \makeatletter
  \newif\ifnotstarredversion
  \renewcommand{\numberline}[1]{#1.~}
  \renewcommand{\thechapter}{\arabic{chapter}}
  \renewcommand*\l@chapter[2]{%
      \ifnum \c@tocdepth >-2\relax
      \addpenalty{-\@highpenalty}%
      \addvspace{10pt \@plus\p@}%
      \setlength\@tempdima{3em}%
      \begingroup
     \tikz[remember picture]{
  	\path (0,0) coordinate (A)--(\linewidth,0) coordinate (B);%
  	\path ($ (A)!0.5!(B) $) node[font=\bfseries\sffamily\large,align=center,text width=\linewidth] (TEXT)
  	{{Chương~#1 - Trang~#2}};
  	 \fill[dnvang!65!black,rounded corners=3.5pt] ([xshift=-2pt]TEXT.north west) rectangle ([xshift=2pt]TEXT.south east);
  	 \fill[dnvang!15,rounded corners=3pt] ([yshift=0.15pt]TEXT.north west) rectangle ([yshift=-0.15pt]TEXT.south east);
  	 \hypersetup{linkcolor=dnvang!85!black}
  	 \path ($ (A)!0.5!(B) $) node[font=\bfseries\sffamily\large\color{dnvang!85!black},align=center,text width=\linewidth] (TEXT)
  		{{Chương~#1 - Trang~#2}};
  	}
      \par\bigskip
  	\penalty\@highpenalty
  	\setcounter{section}{0}
      \endgroup
      \fi
  }
  \makeatother
  
  \renewcommand{\thesection}{Chủ đề \arabic{section}.}
  \titlecontents{section}
    [1.5cm]
    {\hypersetup{linkcolor=black}\vspace*{0.15\baselineskip}\sffamily\bfseries{\thecontentslabel\;}}{}{}
    {\titlerule*[0.65pc]{.}\thecontentspage}
  
  \renewcommand{\thesubsection}{\Alph{subsection})}
  \titlecontents{subsection}
    [2.85cm]
    {\hypersetup{linkcolor=black}\sffamily\vspace*{-0.15\baselineskip}{\thecontentslabel\;}}{}{}  
    {\titlerule*[1pc]{.}\thecontentspage}
  
  \makeatletter
  \renewcommand{\tableofcontents}{%
  \newpage
  \markboth{Mục lục}{Mục lục}
  %\renewcommand{\rightmark}{Mục lục}
  \begin{center}
  	\begin{tcolorbox}[enhanced,hbox,
  			left=8mm,right=8mm,boxrule=0.55pt,
  			bottom=3pt,
  			colback=white,colframe=dnvang,
  			%drop fuzzy midday shadow=black!50!yellow,
  			drop lifted shadow=black!50!yellow,arc is angular,
  			before=\par\vspace*{-1mm},after=\par\bigskip]
  			{\bfseries\Large\color{dnvang}\sffamily MỤC LỤC} 
  		\end{tcolorbox}
  \end{center}
  \newcounter{somucluc}
  \vskip-1.25cm
  \@starttoc{toc}}
  \makeatother